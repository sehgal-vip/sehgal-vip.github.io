---
layout: page
title: Reading List
description: Papers, books, articles, and other things I've found valuable
permalink: /reading/
---

<div class="reading-list">
  <!-- Papers Section -->
  {% if site.data.reading_papers.size > 0 %}
  {% assign papers_by_year_temp = site.data.reading_papers | group_by: "year" %}
  {% assign papers_years = papers_by_year_temp | map: "name" | sort | reverse %}
  {% assign papers_by_author_temp = site.data.reading_papers | group_by: "author" %}
  {% assign papers_authors = papers_by_author_temp | map: "name" | sort %}
  <section class="collapsible-section" data-section="papers">
    <h2 class="section-title">
      <span class="section-icon">ðŸ“„</span>
      Papers
    </h2>
    <div class="section-filters" aria-label="Filter papers">
      <div class="filter-group">
        <button class="filter-toggle" data-filter="year" data-section="papers">
          <span class="filter-label">Year</span>
          <span class="filter-selected-count"></span>
          <svg class="filter-chevron" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="6 9 12 15 18 9"></polyline>
          </svg>
        </button>
        <div class="filter-dropdown filter-year" data-section="papers">
          <label class="filter-option">
            <input type="checkbox" value="all" checked>
            <span>All</span>
          </label>
          {% for y in papers_years %}
          <label class="filter-option">
            <input type="checkbox" value="{{ y }}">
            <span>{{ y }}</span>
          </label>
          {% endfor %}
        </div>
      </div>
      <div class="filter-group">
        <button class="filter-toggle" data-filter="author" data-section="papers">
          <span class="filter-label">Author</span>
          <span class="filter-selected-count"></span>
          <svg class="filter-chevron" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="6 9 12 15 18 9"></polyline>
          </svg>
        </button>
        <div class="filter-dropdown filter-author" data-section="papers">
          <label class="filter-option">
            <input type="checkbox" value="all" checked>
            <span>All</span>
          </label>
          {% for a in papers_authors %}
          <label class="filter-option">
            <input type="checkbox" value="{{ a }}">
            <span>{{ a }}</span>
          </label>
          {% endfor %}
        </div>
      </div>
    </div>
    
    {% assign papers_sorted = site.data.reading_papers | sort: "year" | reverse %}
    <table class="data-table">
      <thead>
        <tr>
          <th>Title</th>
          <th>Author</th>
          <th>Year</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
        {% for item in papers_sorted %}
        <tr data-year="{{ item.year }}" data-author="{{ item.author }}">
          <td class="title-cell" data-label="Title">
            {% if item.url and item.url != "" %}
            <a href="{{ item.url }}" target="_blank" rel="noopener noreferrer">{{ item.title }}</a>
            {% else %}
            {{ item.title }}
            {% endif %}
          </td>
          <td class="author-cell" data-label="Author">{{ item.author }}</td>
          <td class="year-cell" data-label="Year">{{ item.year }}</td>
          <td class="desc-cell" data-label="Description">{{ item.description }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    <div class="section-pagination" data-section="papers">
      <button class="pagination-btn pagination-prev" disabled>
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg>
        Prev
      </button>
      <span class="pagination-info">Page 1 of 1</span>
      <button class="pagination-btn pagination-next">
        Next
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>
      </button>
      <button class="pagination-btn pagination-all">Select All</button>
    </div>
  </section>
  {% endif %}

  <!-- Books Section -->
  {% if site.data.reading_books.size > 0 %}
  {% assign books_by_year_temp = site.data.reading_books | group_by: "year" %}
  {% assign books_years = books_by_year_temp | map: "name" | sort | reverse %}
  {% assign books_by_author_temp = site.data.reading_books | group_by: "author" %}
  {% assign books_authors = books_by_author_temp | map: "name" | sort %}
  <section class="collapsible-section" data-section="books">
    <h2 class="section-title">
      <span class="section-icon">ðŸ“š</span>
      Books
    </h2>
    <div class="section-filters" aria-label="Filter books">
      <div class="filter-group">
        <button class="filter-toggle" data-filter="year" data-section="books">
          <span class="filter-label">Year</span>
          <span class="filter-selected-count"></span>
          <svg class="filter-chevron" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="6 9 12 15 18 9"></polyline>
          </svg>
        </button>
        <div class="filter-dropdown filter-year" data-section="books">
          <label class="filter-option">
            <input type="checkbox" value="all" checked>
            <span>All</span>
          </label>
          {% for y in books_years %}
          <label class="filter-option">
            <input type="checkbox" value="{{ y }}">
            <span>{{ y }}</span>
          </label>
          {% endfor %}
        </div>
      </div>
      <div class="filter-group">
        <button class="filter-toggle" data-filter="author" data-section="books">
          <span class="filter-label">Author</span>
          <span class="filter-selected-count"></span>
          <svg class="filter-chevron" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="6 9 12 15 18 9"></polyline>
          </svg>
        </button>
        <div class="filter-dropdown filter-author" data-section="books">
          <label class="filter-option">
            <input type="checkbox" value="all" checked>
            <span>All</span>
          </label>
          {% for a in books_authors %}
          <label class="filter-option">
            <input type="checkbox" value="{{ a }}">
            <span>{{ a }}</span>
          </label>
          {% endfor %}
        </div>
      </div>
      <div class="filter-group">
        <button class="filter-toggle sort-toggle" data-section="books">
          <span class="filter-label">Sort</span>
          <svg class="filter-chevron" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="6 9 12 15 18 9"></polyline>
          </svg>
        </button>
        <div class="filter-dropdown sort-dropdown" data-section="books">
          <label class="filter-option">
            <input type="radio" name="sort-books" value="year" checked>
            <span>Year</span>
          </label>
          <label class="filter-option">
            <input type="radio" name="sort-books" value="title-asc">
            <span>Title (A-Z)</span>
          </label>
          <label class="filter-option">
            <input type="radio" name="sort-books" value="title-desc">
            <span>Title (Z-A)</span>
          </label>
          <button class="sort-apply-btn" data-section="books">Apply</button>
        </div>
      </div>
    </div>
    
    {% assign books_sorted = site.data.reading_books | sort: "year" | reverse %}
    <table class="data-table">
      <thead>
        <tr>
          <th>Title</th>
          <th>Author</th>
          <th>Year</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
        {% for item in books_sorted %}
        <tr data-year="{{ item.year }}" data-author="{{ item.author }}">
          <td class="title-cell" data-label="Title">
            {% if item.url and item.url != "" %}
            <a href="{{ item.url }}" target="_blank" rel="noopener noreferrer">{{ item.title }}</a>
            {% else %}
            {{ item.title }}
            {% endif %}
          </td>
          <td class="author-cell" data-label="Author">{{ item.author }}</td>
          <td class="year-cell" data-label="Year">{{ item.year }}</td>
          <td class="desc-cell" data-label="Description">{{ item.description }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    <div class="section-pagination" data-section="books">
      <button class="pagination-btn pagination-prev" disabled>
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg>
        Prev
      </button>
      <span class="pagination-info">Page 1 of 1</span>
      <button class="pagination-btn pagination-next">
        Next
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>
      </button>
      <button class="pagination-btn pagination-all">Select All</button>
    </div>
  </section>
  {% endif %}

  <!-- Articles Section -->
  {% if site.data.reading_articles.size > 0 %}
  {% assign articles_by_year_temp = site.data.reading_articles | group_by: "year" %}
  {% assign articles_years = articles_by_year_temp | map: "name" | sort | reverse %}
  {% assign articles_by_author_temp = site.data.reading_articles | group_by: "author" %}
  {% assign articles_authors = articles_by_author_temp | map: "name" | sort %}
  <section class="collapsible-section" data-section="articles">
    <h2 class="section-title">
      <span class="section-icon">ðŸ“°</span>
      Articles
    </h2>
    <div class="section-filters" aria-label="Filter articles">
      <div class="filter-group">
        <button class="filter-toggle" data-filter="year" data-section="articles">
          <span class="filter-label">Year</span>
          <span class="filter-selected-count"></span>
          <svg class="filter-chevron" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="6 9 12 15 18 9"></polyline>
          </svg>
        </button>
        <div class="filter-dropdown filter-year" data-section="articles">
          <label class="filter-option">
            <input type="checkbox" value="all" checked>
            <span>All</span>
          </label>
          {% for y in articles_years %}
          <label class="filter-option">
            <input type="checkbox" value="{{ y }}">
            <span>{{ y }}</span>
          </label>
          {% endfor %}
        </div>
      </div>
      <div class="filter-group">
        <button class="filter-toggle" data-filter="author" data-section="articles">
          <span class="filter-label">Author</span>
          <span class="filter-selected-count"></span>
          <svg class="filter-chevron" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="6 9 12 15 18 9"></polyline>
          </svg>
        </button>
        <div class="filter-dropdown filter-author" data-section="articles">
          <label class="filter-option">
            <input type="checkbox" value="all" checked>
            <span>All</span>
          </label>
          {% for a in articles_authors %}
          <label class="filter-option">
            <input type="checkbox" value="{{ a }}">
            <span>{{ a }}</span>
          </label>
          {% endfor %}
        </div>
      </div>
    </div>
    
    {% assign articles_sorted = site.data.reading_articles | sort: "year" | reverse %}
    <table class="data-table">
      <thead>
        <tr>
          <th>Title</th>
          <th>Author</th>
          <th>Year</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
        {% for item in articles_sorted %}
        <tr data-year="{{ item.year }}" data-author="{{ item.author }}">
          <td class="title-cell" data-label="Title">
            {% if item.url and item.url != "" %}
            <a href="{{ item.url }}" target="_blank" rel="noopener noreferrer">{{ item.title }}</a>
            {% else %}
            {{ item.title }}
            {% endif %}
          </td>
          <td class="author-cell" data-label="Author">{{ item.author }}</td>
          <td class="year-cell" data-label="Year">{{ item.year }}</td>
          <td class="desc-cell" data-label="Description">{{ item.description }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    <div class="section-pagination" data-section="articles">
      <button class="pagination-btn pagination-prev" disabled>
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg>
        Prev
      </button>
      <span class="pagination-info">Page 1 of 1</span>
      <button class="pagination-btn pagination-next">
        Next
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>
      </button>
      <button class="pagination-btn pagination-all">Select All</button>
    </div>
  </section>
  {% endif %}

  <!-- Others Section -->
  {% if site.data.reading_others.size > 0 %}
  {% assign others_by_year_temp = site.data.reading_others | group_by: "year" %}
  {% assign others_years = others_by_year_temp | map: "name" | sort | reverse %}
  {% assign others_by_author_temp = site.data.reading_others | group_by: "author" %}
  {% assign others_authors = others_by_author_temp | map: "name" | sort %}
  <section class="collapsible-section" data-section="others">
    <h2 class="section-title">
      <span class="section-icon">ðŸ”—</span>
      Others
    </h2>
    <div class="section-filters" aria-label="Filter others">
      <div class="filter-group">
        <button class="filter-toggle" data-filter="year" data-section="others">
          <span class="filter-label">Year</span>
          <span class="filter-selected-count"></span>
          <svg class="filter-chevron" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="6 9 12 15 18 9"></polyline>
          </svg>
        </button>
        <div class="filter-dropdown filter-year" data-section="others">
          <label class="filter-option">
            <input type="checkbox" value="all" checked>
            <span>All</span>
          </label>
          {% for y in others_years %}
          <label class="filter-option">
            <input type="checkbox" value="{{ y }}">
            <span>{{ y }}</span>
          </label>
          {% endfor %}
        </div>
      </div>
      <div class="filter-group">
        <button class="filter-toggle" data-filter="author" data-section="others">
          <span class="filter-label">Author</span>
          <span class="filter-selected-count"></span>
          <svg class="filter-chevron" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="6 9 12 15 18 9"></polyline>
          </svg>
        </button>
        <div class="filter-dropdown filter-author" data-section="others">
          <label class="filter-option">
            <input type="checkbox" value="all" checked>
            <span>All</span>
          </label>
          {% for a in others_authors %}
          <label class="filter-option">
            <input type="checkbox" value="{{ a }}">
            <span>{{ a }}</span>
          </label>
          {% endfor %}
        </div>
      </div>
      <div class="filter-group">
        <button class="filter-toggle sort-toggle" data-section="others">
          <span class="filter-label">Sort</span>
          <svg class="filter-chevron" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="6 9 12 15 18 9"></polyline>
          </svg>
        </button>
        <div class="filter-dropdown sort-dropdown" data-section="others">
          <label class="filter-option">
            <input type="radio" name="sort-others" value="year" checked>
            <span>Year</span>
          </label>
          <label class="filter-option">
            <input type="radio" name="sort-others" value="title-asc">
            <span>Title (A-Z)</span>
          </label>
          <label class="filter-option">
            <input type="radio" name="sort-others" value="title-desc">
            <span>Title (Z-A)</span>
          </label>
          <button class="sort-apply-btn" data-section="others">Apply</button>
        </div>
      </div>
    </div>
    
    {% assign others_sorted = site.data.reading_others | sort: "year" | reverse %}
    <table class="data-table">
      <thead>
        <tr>
          <th>Title</th>
          <th>Author</th>
          <th>Year</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
        {% for item in others_sorted %}
        <tr data-year="{{ item.year }}" data-author="{{ item.author }}">
          <td class="title-cell" data-label="Title">
            {% if item.url and item.url != "" %}
            <a href="{{ item.url }}" target="_blank" rel="noopener noreferrer">{{ item.title }}</a>
            {% else %}
            {{ item.title }}
            {% endif %}
          </td>
          <td class="author-cell" data-label="Author">{{ item.author }}</td>
          <td class="year-cell" data-label="Year">{{ item.year }}</td>
          <td class="desc-cell" data-label="Description">{{ item.description }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    <div class="section-pagination" data-section="others">
      <button class="pagination-btn pagination-prev" disabled>
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg>
        Prev
      </button>
      <span class="pagination-info">Page 1 of 1</span>
      <button class="pagination-btn pagination-next">
        Next
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>
      </button>
      <button class="pagination-btn pagination-all">Select All</button>
    </div>
  </section>
  {% endif %}
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Pagination state per section
  const paginationState = {
    papers: { page: 1, perPage: 5, showAll: false },
    books: { page: 1, perPage: 5, showAll: false },
    articles: { page: 1, perPage: 5, showAll: false },
    others: { page: 1, perPage: 5, showAll: false }
  };

  // Collapsible filter dropdowns
  const filterToggles = document.querySelectorAll('.filter-toggle');
  const filterDropdowns = document.querySelectorAll('.filter-dropdown');

  // Toggle dropdown visibility
  filterToggles.forEach(toggle => {
    toggle.addEventListener('click', function(e) {
      e.stopPropagation();
      const dropdown = this.nextElementSibling;
      const isOpen = dropdown.classList.contains('open');

      // Close all other dropdowns
      filterDropdowns.forEach(d => {
        if (d !== dropdown) {
          d.classList.remove('open');
          d.previousElementSibling.classList.remove('active');
        }
      });

      // Toggle current dropdown
      dropdown.classList.toggle('open', !isOpen);
      this.classList.toggle('active', !isOpen);
    });
  });

  // Close dropdowns when clicking outside
  document.addEventListener('click', function(e) {
    if (!e.target.closest('.filter-group')) {
      filterDropdowns.forEach(d => {
        d.classList.remove('open');
        d.previousElementSibling.classList.remove('active');
      });
    }
  });

  // Get selected values from checkboxes
  const getSelectedValues = (dropdown) => {
    const checkboxes = dropdown.querySelectorAll('input[type="checkbox"]:checked');
    return Array.from(checkboxes).map(cb => cb.value);
  };

  // Update selected count display
  const updateSelectedCount = (toggle, dropdown) => {
    if (!toggle || !dropdown) return;
    const selected = getSelectedValues(dropdown);
    const count = selected.includes('all') ? 0 : selected.length;
    const countSpan = toggle.querySelector('.filter-selected-count');
    if (countSpan) {
      if (count > 0) {
        countSpan.textContent = `(${count})`;
      } else {
        countSpan.textContent = '';
      }
    }
  };

  // Handle checkbox changes
  filterDropdowns.forEach(dropdown => {
    const checkboxes = dropdown.querySelectorAll('input[type="checkbox"]');
    const toggle = dropdown.previousElementSibling;

    checkboxes.forEach(checkbox => {
      checkbox.addEventListener('change', function() {
        const allCheckbox = dropdown.querySelector('input[type="checkbox"][value="all"]');

        if (this.value === 'all') {
          // If "All" is checked, uncheck all others
          if (this.checked) {
            checkboxes.forEach(cb => {
              if (cb !== this) cb.checked = false;
            });
          }
        } else {
          // If any other option is checked, uncheck "All"
          if (this.checked) {
            allCheckbox.checked = false;
          }

          // If nothing is selected, check "All"
          const hasSelection = Array.from(checkboxes).some(cb => cb !== allCheckbox && cb.checked);
          if (!hasSelection) {
            allCheckbox.checked = true;
          }
        }

        updateSelectedCount(toggle, dropdown);

        // Reset pagination when filters change
        const sectionName = dropdown.dataset.section;
        if (sectionName && paginationState[sectionName]) {
          paginationState[sectionName].page = 1;
        }

        applyFilters();
      });
    });

    // Initial count update
    updateSelectedCount(toggle, dropdown);
  });

  // Filtering per section
  const sections = document.querySelectorAll('.collapsible-section');

  // Get visible rows that match current filters
  const getFilteredRows = (section) => {
    const yearDropdown = section.querySelector('.filter-year');
    const authorDropdown = section.querySelector('.filter-author');
    const table = section.querySelector('.data-table');

    if (!table) return [];

    const selectedYears = yearDropdown ? getSelectedValues(yearDropdown) : ['all'];
    const selectedAuthors = authorDropdown ? getSelectedValues(authorDropdown) : ['all'];

    const rows = table.querySelectorAll('tbody tr');
    const filteredRows = [];

    rows.forEach(row => {
      const rowYear = row.getAttribute('data-year');
      const rowAuthor = row.getAttribute('data-author');
      const matchYear = selectedYears.includes('all') || selectedYears.includes(rowYear);
      const matchAuthor = selectedAuthors.includes('all') || selectedAuthors.includes(rowAuthor);
      if (matchYear && matchAuthor) {
        filteredRows.push(row);
      }
    });

    return filteredRows;
  };

  // Apply pagination to a section
  const applyPagination = (section, sectionName) => {
    const state = paginationState[sectionName];
    if (!state) return;

    const filteredRows = getFilteredRows(section);
    const table = section.querySelector('.data-table');
    const allRows = table ? table.querySelectorAll('tbody tr') : [];

    // First hide all rows
    allRows.forEach(row => row.style.display = 'none');

    if (state.showAll) {
      // Show all filtered rows
      filteredRows.forEach(row => row.style.display = '');
    } else {
      // Apply pagination
      const startIndex = (state.page - 1) * state.perPage;
      const endIndex = startIndex + state.perPage;

      filteredRows.forEach((row, index) => {
        if (index >= startIndex && index < endIndex) {
          row.style.display = '';
        }
      });
    }

    // Hide table if no rows match
    if (table) {
      table.style.display = filteredRows.length > 0 ? '' : 'none';
    }

    // Update pagination UI
    updatePaginationUI(section, sectionName, filteredRows.length);

    // Clear selection if filtered or paged out
    if (selectedRow && selectedRow.style.display === 'none') {
      setSelectedRow(null);
    }
  };

  // Update pagination UI elements
  const updatePaginationUI = (section, sectionName, totalRows) => {
    const state = paginationState[sectionName];
    const paginationContainer = section.querySelector('.section-pagination');

    if (!paginationContainer || !state) return;

    const prevBtn = paginationContainer.querySelector('.pagination-prev');
    const nextBtn = paginationContainer.querySelector('.pagination-next');
    const allBtn = paginationContainer.querySelector('.pagination-all');
    const infoSpan = paginationContainer.querySelector('.pagination-info');

    const totalPages = Math.ceil(totalRows / state.perPage);

    if (state.showAll) {
      // Show all mode
      if (infoSpan) infoSpan.textContent = `Showing all ${totalRows} items`;
      if (prevBtn) prevBtn.disabled = true;
      if (nextBtn) nextBtn.disabled = true;
      if (allBtn) allBtn.textContent = 'Show Less';
    } else {
      // Paginated mode
      if (infoSpan) {
        if (totalPages === 0) {
          infoSpan.textContent = 'No items';
        } else {
          infoSpan.textContent = `Page ${state.page} of ${totalPages}`;
        }
      }
      if (prevBtn) prevBtn.disabled = state.page <= 1;
      if (nextBtn) nextBtn.disabled = state.page >= totalPages;
      if (allBtn) allBtn.textContent = 'Select All';
    }

    // Hide pagination if only one page and not in showAll mode
    if (totalPages <= 1 && !state.showAll) {
      paginationContainer.style.display = totalRows > 0 ? 'flex' : 'none';
      if (prevBtn) prevBtn.style.display = 'none';
      if (nextBtn) nextBtn.style.display = 'none';
      if (allBtn) allBtn.style.display = totalRows > state.perPage ? '' : 'none';
    } else {
      paginationContainer.style.display = 'flex';
      if (prevBtn) prevBtn.style.display = '';
      if (nextBtn) nextBtn.style.display = '';
      if (allBtn) allBtn.style.display = '';
    }
  };

  const applyFilters = () => {
    sections.forEach(section => {
      const sectionName = section.dataset.section;
      applyPagination(section, sectionName);
    });
  };

  // Set up pagination button handlers
  document.querySelectorAll('.section-pagination').forEach(paginationContainer => {
    const sectionName = paginationContainer.dataset.section;
    const section = document.querySelector(`.collapsible-section[data-section="${sectionName}"]`);

    if (!section || !paginationState[sectionName]) return;

    const prevBtn = paginationContainer.querySelector('.pagination-prev');
    const nextBtn = paginationContainer.querySelector('.pagination-next');
    const allBtn = paginationContainer.querySelector('.pagination-all');

    if (prevBtn) {
      prevBtn.addEventListener('click', () => {
        const state = paginationState[sectionName];
        if (state.page > 1) {
          state.page--;
          applyPagination(section, sectionName);
        }
      });
    }

    if (nextBtn) {
      nextBtn.addEventListener('click', () => {
        const state = paginationState[sectionName];
        const filteredRows = getFilteredRows(section);
        const totalPages = Math.ceil(filteredRows.length / state.perPage);
        if (state.page < totalPages) {
          state.page++;
          applyPagination(section, sectionName);
        }
      });
    }

    if (allBtn) {
      allBtn.addEventListener('click', () => {
        const state = paginationState[sectionName];
        state.showAll = !state.showAll;
        if (!state.showAll) {
          state.page = 1;
        }
        applyPagination(section, sectionName);
      });
    }
  });

  // Keyboard navigation
  const selectionClass = 'row-selected';
  let selectedRow = null;

  const isTypingInInput = (el) => {
    if (!el) return false;
    const tag = el.tagName ? el.tagName.toLowerCase() : '';
    return el.isContentEditable || tag === 'input' || tag === 'textarea' || tag === 'select';
  };

  const isCommandPaletteOpen = () => {
    if (window.ModalManager && typeof window.ModalManager.isOpen === 'function') {
      if (window.ModalManager.isOpen('command-palette')) return true;
    }
    return !!document.querySelector('#command-palette.is-open');
  };

  const getVisibleRows = (section) => {
    if (!section) return [];
    return Array.from(section.querySelectorAll('tbody tr'))
      .filter(row => row.style.display !== 'none');
  };

  const setSelectedRow = (row) => {
    if (selectedRow) {
      selectedRow.classList.remove(selectionClass);
      selectedRow.removeAttribute('aria-selected');
    }
    selectedRow = row;
    if (selectedRow) {
      selectedRow.classList.add(selectionClass);
      selectedRow.setAttribute('aria-selected', 'true');
      selectedRow.scrollIntoView({ block: 'nearest' });
    }
  };

  const openSelectedRowLink = () => {
    if (!selectedRow) return;
    const link = selectedRow.querySelector('a');
    if (link) link.click();
  };

  const getSectionIndex = (section) => {
    return Array.from(sections).indexOf(section);
  };

  const getNextSectionWithRows = (fromIndex) => {
    for (let i = fromIndex + 1; i < sections.length; i++) {
      if (getVisibleRows(sections[i]).length > 0) return sections[i];
    }
    return null;
  };

  const getPrevSectionWithRows = (fromIndex) => {
    for (let i = fromIndex - 1; i >= 0; i--) {
      if (getVisibleRows(sections[i]).length > 0) return sections[i];
    }
    return null;
  };

  const moveToSection = (section, position) => {
    if (!section) return;
    const sectionName = section.dataset.section;
    const state = paginationState[sectionName];
    if (state && !state.showAll) {
      const filteredRows = getFilteredRows(section);
      const totalPages = Math.ceil(filteredRows.length / state.perPage);
      if (position === 'start') {
        state.page = 1;
      } else if (position === 'end') {
        state.page = Math.max(1, totalPages);
      }
      applyPagination(section, sectionName);
    }
    const rows = getVisibleRows(section);
    if (!rows.length) return;
    setSelectedRow(position === 'end' ? rows[rows.length - 1] : rows[0]);
  };

  const moveSelection = (direction) => {
    const allSections = Array.from(sections);
    if (!allSections.length) return;

    if (!selectedRow) {
      if (direction === 'down') {
        const firstSection = getNextSectionWithRows(-1);
        moveToSection(firstSection, 'start');
      } else {
        const lastSection = getPrevSectionWithRows(allSections.length);
        moveToSection(lastSection, 'end');
      }
      return;
    }

    const currentSection = selectedRow.closest('.collapsible-section');
    if (!currentSection) return;
    const sectionName = currentSection.dataset.section;
    const state = paginationState[sectionName];
    const visibleRows = getVisibleRows(currentSection);
    const rowIndex = visibleRows.indexOf(selectedRow);

    if (direction === 'down') {
      if (rowIndex < visibleRows.length - 1) {
        setSelectedRow(visibleRows[rowIndex + 1]);
        return;
      }
      if (state && !state.showAll) {
        const filteredRows = getFilteredRows(currentSection);
        const totalPages = Math.ceil(filteredRows.length / state.perPage);
        if (state.page < totalPages) {
          state.page++;
          applyPagination(currentSection, sectionName);
          const rows = getVisibleRows(currentSection);
          if (rows.length) setSelectedRow(rows[0]);
          return;
        }
      }
      const nextSection = getNextSectionWithRows(getSectionIndex(currentSection));
      moveToSection(nextSection, 'start');
    } else {
      if (rowIndex > 0) {
        setSelectedRow(visibleRows[rowIndex - 1]);
        return;
      }
      if (state && !state.showAll) {
        if (state.page > 1) {
          state.page--;
          applyPagination(currentSection, sectionName);
          const rows = getVisibleRows(currentSection);
          if (rows.length) setSelectedRow(rows[rows.length - 1]);
          return;
        }
      }
      const prevSection = getPrevSectionWithRows(getSectionIndex(currentSection));
      moveToSection(prevSection, 'end');
    }
  };

  document.addEventListener('keydown', function(e) {
    if (isCommandPaletteOpen()) return;
    if (isTypingInInput(e.target)) return;
    if (e.metaKey || e.ctrlKey || e.altKey) return;

    if (e.key === 'ArrowDown') {
      e.preventDefault();
      moveSelection('down');
    } else if (e.key === 'ArrowUp') {
      e.preventDefault();
      moveSelection('up');
    } else if (e.key === 'Enter' || e.key === ' ' || e.key === 'Spacebar') {
      if (selectedRow) {
        e.preventDefault();
        openSelectedRowLink();
      }
    }
  });

  // Initial filter and pagination application
  applyFilters();
});
</script>
